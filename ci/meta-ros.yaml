- defaults:
    name: ROS_defaults
    project-type: freestyle
    defaults: global
    disabled: false
    concurrent: true
    node: 'docker || dockernew'

    logrotate:
      numToKeep: 10

    properties:
      - authorization:
         anonymous:
         - job-discover
         - job-read
         - job-build
         - job-cancel
         - run-update
    wrappers:
      - timestamps
      - workspace-cleanup
      - ansicolor:
          colormap: xterm

- builder:
    name: yocto-docker-builder-meta-ros-on-master-branches
    builders:
        - shell:
            !include-raw yocto-docker-meta-ros-on-master-branches.sh

- builder:
    name: yocto-docker-builder-meta-ros-on-fido-branches
    builders:
        - shell:
            !include-raw yocto-docker-meta-ros-on-fido-branches.sh

- publisher:
    name: publisher-yocto
    publishers:
      - post-tasks:
          - escalate-status: false
            run-if-job-successful: false
            escalate-status: false
            script: |
              #!/bin/bash

              echo
              echo "#################################"
              echo "########### cleanup #############"
              echo "#################################"
              echo
              echo "Deleting tmp contents"
              rm -rf meta-ros-build/tmp/*
              echo "Unmounting ramdisk"
              sudo umount meta-ros-build/tmp

- job-template:
    name: ROS_{name}-on-fido-branches_nightly
    defaults: 'ROS_defaults'
    description: "meta-ros on fido branches nightly build.\nContact: Lukas Bulwahn"
    builders:
        - yocto-docker-builder-meta-ros-on-fido-branches
    triggers:
        - timed: 'H 19 * * *'
    publishers:
      - publisher-yocto
      - email:
          recipients: lukas.bulwahn@oss.bmw-carit.de

- job-template:
    name: ROS_{name}-on-master-branches_nightly
    defaults: 'ROS_defaults'
    description: "meta-ros on master branches nightly build.\nContact: Lukas Bulwahn"
    builders:
      - yocto-docker-builder-meta-ros-on-master-branches
    triggers:
      - timed: 'H 03 * * *'
    publishers:
      - publisher-yocto
      - email:
          recipients: lukas.bulwahn@oss.bmw-carit.de

- project:
    name: meta-ros
    jobs:
      - ROS_{name}-on-fido-branches_nightly
      - ROS_{name}-on-master-branches_nightly
